{{- $apiPath := .Params.api_spec -}}
{{- $apiData := index .Site.Data (replace $apiPath ".yaml" "") -}}

{{- if not $apiData -}}
  {{- errorf "Failed to load OpenAPI spec: %s" $apiPath -}}
{{- end -}}

{
  "title": {{ .Title | jsonify }},
  "description": {{ .Description | jsonify }},
  "url": {{ .Permalink | jsonify }},
  "date": {{ .Date.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
  "lastmod": {{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
  "spec": {
    "openapi": {{ $apiData.openapi | jsonify }},
    "info": {{ $apiData.info | jsonify }},
    "servers": {{ $apiData.servers | jsonify }},
    "pathCount": {{ len $apiData.paths }},
    "componentCount": {{ if $apiData.components }}{{ len $apiData.components }}{{ else }}0{{ end }},
    "hasAuthentication": {{ if $apiData.security }}true{{ else }}false{{ end }}
  }
}