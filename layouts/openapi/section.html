{{- define "top-bar" -}}
  {{- partial "navigation/topbar/main.html" . -}}
{{- end -}}

{{- define "sidebar-left" -}}
  <!-- Mobile navigation toggle -->
  <button id="mobileNavToggle" class="fixed top-4 left-4 z-50 md:hidden bg-brand text-white p-2 rounded-lg shadow-lg" aria-label="Toggle navigation menu" data-component="navigation-mobile-toggle">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
  </button>

  <!-- Mobile navigation overlay -->
  <div id="mobileNavOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden" data-component="navigation-mobile-overlay"></div>

  <aside id="sidebar-left" class="sidebar-container fixed md:sticky left-0 top-0 md:top-16 z-40 h-full md:h-[calc(100vh-4rem)] w-80 md:w-1/5 md:max-w-80 shadow-xl md:shadow-none transform -translate-x-full md:translate-x-0 transition-all duration-300 ease-in-out md:flex" data-component="navigation-sidebar-left">
      <!-- Mobile header -->
      <div class="sidebar-header flex md:hidden items-center justify-between p-4">
          <h2 class="text-lg font-semibold">API Reference</h2>
          <button id="closeMobileNav" class="sidebar-close-btn p-2 rounded-lg" aria-label="Close navigation menu">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
          </button>
      </div>
      
      <div id="linkTree" class="pt-4 md:pt-4 px-4 md:px-0 h-[calc(100vh-4rem)] md:h-full overflow-y-auto w-full">
          {{ $currentpg := . }}
          {{/* Show only API section and its children */}}
          {{ $apiSection := .Site.GetPage "/api" }}
          {{ if $apiSection }}
            {{ partial "navigation/directory.html" (dict "dir" (slice $apiSection) "current" $currentpg "level" 1) }}
          {{ end }}
      </div>
  </aside>
{{- end -}}

{{- define "content" -}}
<article id="articleContent" 
         class="openapi-spec api-overview"
         data-component="openapi-viewer">

  
  {{- $apiData := .Params.api_data -}}
  
  {{- if not $apiData -}}
    <div class="error-message">
      <h2>API Data Not Found</h2>
      <p>Could not load API data from page front matter.</p>
    </div>
    {{ return }}
  {{- end -}}

  <!-- API Header -->
  {{ partial "openapi/header.html" (dict "spec" $apiData "page" .) }}
  
  <!-- Main API Overview Content -->
  <div class="openapi-content">
    <!-- Overview Section -->
    {{ with $apiData.Info }}
      {{ partial "openapi/overview.html" (dict "info" . "page" $.Page) }}
    {{ end }}
    
    <!-- Server Information -->
    {{ with $apiData.Servers }}
      {{ partial "openapi/servers.html" (dict "servers" . "page" $.Page) }}
    {{ end }}
    
    <!-- Endpoint Groups -->
    <section class="api-endpoint-groups" id="endpoint-groups">
      <h2>API Endpoint Groups</h2>
      <div class="endpoint-groups-grid">
        {{/* Get all child pages (tag sections) */}}
        {{ range .Pages }}
          <div class="endpoint-group-card">
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
            <p>{{ .Description }}</p>
            <div class="endpoint-count">
              {{ len .Pages }} endpoint{{ if ne (len .Pages) 1 }}s{{ end }}
            </div>
          </div>
        {{ end }}
      </div>
    </section>
    
    <!-- Components Section -->
    {{ with $apiData.Components }}
      {{ partial "openapi/components.html" (dict "components" . "spec" $apiData "page" $.Page) }}
    {{ end }}
    
    <!-- Security Section -->
    {{ with $apiData.Security }}
      {{ partial "openapi/security.html" (dict "security" . "components" $apiData.Components "page" $.Page) }}
    {{ end }}
  </div>
  
  <!-- Page Content (from markdown) -->
  <div class="page-content">
    {{ .Content }}
  </div>
  
  <!-- API Metadata for JavaScript -->
  <script type="application/json" id="openapi-metadata">
  {
    "title": {{ $apiData.Info.Title | jsonify }},
    "version": {{ $apiData.Info.Version | jsonify }},
    "type": "overview"
  }
  </script>
</article>
{{- end -}}

{{- define "sidebar-right" -}}
  {{- partial "navigation/sidebar-right.html" . -}}
{{- end -}}