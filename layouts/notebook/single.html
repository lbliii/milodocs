{{- define "top-bar" -}}
  {{- partial "navigation/topbar/main.html" . -}}
{{- end -}}

{{- define "sidebar-left" -}}
  {{- partial "navigation/sidebar-left.html" . -}}
{{- end -}}

{{- define "content" -}}

      <article id="articleContent" 
               data-component="notebook-progressive-reveal">
  
  {{- $notebookPath := .Params.notebook_path -}}
  {{- with resources.Get $notebookPath -}}
    {{- $resource := . -}}
    {{- $content := $resource.Content | safeHTML -}}
    {{- with $content | transform.Unmarshal -}}
      {{- $decodedNotebook := . -}}
      
      {{ partial "notebook/header.html" . }}
      
      <div class="notebook__cells" 
           data-notebook-id="{{ .Permalink | base64Encode }}"
           data-cell-count="{{ len $decodedNotebook.cells }}">
          {{ range $index, $cell := $decodedNotebook.cells }}
            {{/* Add hidden class to all cells except first few */}}
            {{ $isInitiallyVisible := lt $index 5 }}
            <div class="notebook-cell-wrapper{{ if not $isInitiallyVisible }} notebook-cell--hidden{{ end }}" 
                 data-cell-index="{{ $index }}">
              {{ if eq $cell.cell_type "markdown" }}
                {{ partial "notebook/cell-markdown.html" (dict "cell" $cell "index" $index) }}
              {{ else if eq $cell.cell_type "code" }}
                {{ partial "notebook/cell-code.html" (dict "cell" $cell "index" $index) }}
              {{ else if eq $cell.cell_type "raw" }}
                {{ partial "notebook/cell-raw.html" (dict "cell" $cell "index" $index) }}
              {{ else }}
                {{/* Unknown cell type - render as raw */}}
                {{ partial "notebook/cell-raw.html" (dict "cell" $cell "index" $index) }}
              {{ end }}
            </div>
          {{ end }}
      </div>
      
      {{/* Simple metadata for JavaScript */}}
      <script type="application/json" id="notebook-metadata">
      {
        "totalCells": {{ len $decodedNotebook.cells }},
        "initiallyVisible": 5,
        "batchSize": 20
      }
      </script>
      
    {{- else -}}
      {{- errorf "Failed to unmarshal notebook: %s" $notebookPath -}}
    {{- end -}}
  {{- else -}}
    {{- errorf "Failed to get notebook resource: %s" $notebookPath -}}
    {{- errorf "Current working directory: %s" (os.Getwd) -}}
  {{- end -}}
</article>

{{/* Include the toggleCollapse function for notebook cells */}}
<script>
// Only define the function once
if (typeof window.toggleCollapse === 'undefined') {
    window.toggleCollapse = function(id) {
        const collapse = document.getElementById(id);
        if (!collapse) return;
        
        const header = collapse.querySelector('.collapse__header');
        const isExpanded = collapse.classList.contains('expanded');
        
        if (isExpanded) {
            collapse.classList.remove('expanded');
            header.setAttribute('aria-expanded', 'false');
        } else {
            collapse.classList.add('expanded');
            header.setAttribute('aria-expanded', 'true');
        }
    };
}
</script>


{{- end -}}

{{- define "sidebar-right" -}}
{{- partial "navigation/sidebar-right.html" . -}}
{{- end -}} 