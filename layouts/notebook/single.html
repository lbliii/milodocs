{{- define "top-bar" -}}
  {{- partial "navigation/topbar/main.html" . -}}
{{- end -}}

{{- define "sidebar-left" -}}
  {{- partial "navigation/sidebar-left.html" . -}}
{{- end -}}

{{- define "content" -}}

      <article id="articleContent" class="article-content"
               data-component="notebook-progressive-reveal"
               data-view="normal">
  
  {{- $notebookPath := .Params.notebook_path -}}
  {{- with resources.Get $notebookPath -}}
    {{- $resource := . -}}
    {{- $content := $resource.Content | safeHTML -}}
    {{- with $content | transform.Unmarshal -}}
      {{- $decodedNotebook := . -}}
      
      {{ partial "notebook/header.html" . }}
      
      <!-- Notebook Toolbar -->
      <div class="notebook__toolbar" data-component="notebook-density">
        <div class="notebook__density-toggle">
          <button class="notebook__density-btn notebook__density-btn--active" 
                  data-density="normal">Normal</button>
          <button class="notebook__density-btn" 
                  data-density="compact">Compact</button>
          <button class="notebook__density-btn" 
                  data-density="comfortable">Comfortable</button>
        </div>
        
        <div class="notebook__cell-counter">
          <span data-visible-cells="5">5</span> / <span data-total-cells="{{ len $decodedNotebook.cells }}">{{ len $decodedNotebook.cells }}</span> cells
        </div>
        
                        <div class="notebook__actions">
                  <button class="notebook__nav-btn" 
                          data-action="collapse-all"
                          title="Collapse all cells">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7-7m0 0l-7 7m7-7v18"/>
                    </svg>
                  </button>
                  <button class="notebook__nav-btn" 
                          data-action="expand-all"
                          title="Expand all cells">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7 7m0 0l7-7m-7 7V3"/>
                    </svg>
                  </button>
                  
                  {{/* Notebook Launch Dropdown */}}
                  {{ partial "notebook/launch-dropdown.html" $ }}
                </div>
      </div>
      
      <div class="notebook__cells" 
           data-notebook-id="{{ .Permalink | base64Encode }}"
           data-cell-count="{{ len $decodedNotebook.cells }}"
           data-density="normal">
          {{ range $index, $cell := $decodedNotebook.cells }}
            {{/* Add hidden class to all cells except first few */}}
            {{ $isInitiallyVisible := lt $index 5 }}
            <div class="notebook-cell-wrapper{{ if not $isInitiallyVisible }} notebook-cell--hidden{{ end }}" 
                 data-cell-index="{{ $index }}">
              {{ if eq $cell.cell_type "markdown" }}
                {{ partial "notebook/cell-markdown.html" (dict "cell" $cell "index" $index) }}
              {{ else if eq $cell.cell_type "code" }}
                {{ partial "notebook/cell-code.html" (dict "cell" $cell "index" $index) }}
              {{ else if eq $cell.cell_type "raw" }}
                {{ partial "notebook/cell-raw.html" (dict "cell" $cell "index" $index) }}
              {{ else }}
                {{/* Unknown cell type - render as raw */}}
                {{ partial "notebook/cell-raw.html" (dict "cell" $cell "index" $index) }}
              {{ end }}
            </div>
          {{ end }}
      </div>
      

      
      {{/* Enhanced metadata for JavaScript */}}
      <script type="application/json" id="notebook-metadata">
      {
        "totalCells": {{ len $decodedNotebook.cells }},
        "initiallyVisible": 5,
        "batchSize": 20,
        "cells": [
          {{ range $index, $cell := $decodedNotebook.cells }}
            {
              "index": {{ $index }},
              "type": "{{ $cell.cell_type }}",
              "id": "cell-{{ $cell.cell_type }}-{{ $index }}",
              {{ with $cell.execution_count }}"executionCount": {{ . }},{{ end }}
              "hasOutput": {{ if $cell.outputs }}true{{ else }}false{{ end }}
            }{{ if ne $index (sub (len $decodedNotebook.cells) 1) }},{{ end }}
          {{ end }}
        ]
      }
      </script>
      
    {{- else -}}
      {{- errorf "Failed to unmarshal notebook: %s" $notebookPath -}}
    {{- end -}}
  {{- else -}}
    {{- errorf "Failed to get notebook resource: %s" $notebookPath -}}
    {{- errorf "Current working directory: %s" (os.Getwd) -}}
  {{- end -}}
</article>

{{/* Inline JS removed. Notebook cells use Collapse/Notebook components. */}}


{{- end -}}

{{- define "sidebar-right" -}}
{{- partial "navigation/sidebar-right.html" . -}}
{{- end -}} 