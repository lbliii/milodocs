<nav id="topNav" class="topbar" data-component="navigation-topbar">
    <!-- Logo Area -->
    <div class="topbar__logo">
        {{- partial "navigation/topbar/logo.html" . -}}
    </div>
    
    <!-- Navigation Links Area -->
    <div class="topbar__navigation">
        {{- partial "navigation/topbar/links.html" . -}}
    </div>
    
    <!-- Search Area -->
    <div class="topbar__search">
        {{- partial "navigation/topbar/search.html" . -}}
    </div>
    
    <!-- Controls Area -->
    <div class="topbar__controls">
        {{- partial "navigation/language-switcher.html" . -}}
        
        <div id="chatTocToggle" class="chat-toc-toggle" role="group" aria-label="Switch between Chat and Table of Contents" data-component="chat-toc-toggle">
            <button class="chat-toc-toggle__option" data-mode="chat" aria-label="Switch to Chat" title="Chat Panel">
                <img src="{{ "icons/light/robot.svg" | relURL }}" alt="Chat" class="icon chat-toc-toggle__icon">
            </button>
            <button class="chat-toc-toggle__option" data-mode="toc" aria-label="Switch to Table of Contents" title="Table of Contents">
                <img src="{{ "icons/light/toc.svg" | relURL }}" alt="TOC" class="icon chat-toc-toggle__icon">
            </button>
        </div>
        
        <!-- Inline script to set button state immediately, preventing flicker -->
        <script>
        (function() {
            try {
                const savedState = localStorage.getItem('chatTocSettings') || 'chat';
                const toggle = document.getElementById('chatTocToggle');
                if (toggle) {
                    const chatBtn = toggle.querySelector('[data-mode="chat"]');
                    const tocBtn = toggle.querySelector('[data-mode="toc"]');
                    
                    // Set button states only - containers will be handled later
                    if (savedState === 'chat') {
                        chatBtn?.classList.add('chat-toc-toggle__option--active');
                        tocBtn?.classList.remove('chat-toc-toggle__option--active');
                    } else {
                        chatBtn?.classList.remove('chat-toc-toggle__option--active');
                        tocBtn?.classList.add('chat-toc-toggle__option--active');
                    }
                    
                    // Show the component immediately with correct button state
                    toggle.classList.add('initialized');
                }
            } catch (e) {
                // Fallback: show with default state
                document.getElementById('chatTocToggle')?.classList.add('initialized');
            }
        })();
        </script>
        
        <button id="darkModeToggle" aria-label="Toggle Darkmode" class="topbar__button" data-component="theme-toggle">
            <img id="moon" src="{{ "icons/light/dark.svg" | relURL }}" alt="moon" class="icon hidden" title="Dark Mode">
            <img id="sun" src="{{ "icons/light/light.svg" | relURL }}" alt="sun" class="icon hidden" title="Light Mode">
        </button>
    </div>
</nav>