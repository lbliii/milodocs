
{{/* Build CSS resources array */}}
{{- $cssResources := slice -}}

{{/* Add main CSS */}}
{{- $mainCSS := resources.Get "css/main.css" -}}
{{- if $mainCSS -}}
  {{- $cssResources = $cssResources | append $mainCSS -}}
{{- else -}}
  {{- warnf "CSS: main.css not found" -}}
{{- end -}}

{{/* Environment-specific resource loading with advanced optimization */}}
{{- $env := hugo.Environment -}}

{{/* Critical font preloading with environment-specific fonts */}}
{{- if eq $env "nvidia" -}}
  {{/* NVIDIA: Preload critical brand fonts for optimal performance */}}
  <link rel="preload" href="https://images.nvidia.com/etc/designs/nvidiaGDC/clientlibs_base/fonts/nvidia-sans/GLOBAL/var/NVIDIASansVF_W_Wght.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="https://images.nvidia.com/etc/designs/nvidiaGDC/clientlibs_base/fonts/nvidia-sans/GLOBAL/NVIDIASans_W_Rg.woff2" as="font" type="font/woff2" crossorigin>
  
  {{- $envFonts := resources.Get "css/fonts-nvidia.css" -}}
  {{- if $envFonts -}}
    {{- $cssResources = $cssResources | append $envFonts -}}
  {{- else -}}
    {{- warnf "Environment CSS: fonts-nvidia.css not found, falling back to default fonts" -}}
    {{- $fallbackFonts := resources.Get "css/fonts.css" -}}
    {{- if $fallbackFonts -}}{{- $cssResources = $cssResources | append $fallbackFonts -}}{{- end -}}
  {{- end -}}
{{- else -}}
  {{/* Default: Load standard web fonts */}}
  {{- $defaultFonts := resources.Get "css/fonts.css" -}}
  {{- if $defaultFonts -}}
    {{- $cssResources = $cssResources | append $defaultFonts -}}
  {{- else -}}
    {{- warnf "Environment CSS: fonts.css not found" -}}
  {{- end -}}
{{- end -}}

{{/* Environment-specific color schemes with smart fallbacks */}}
{{- $colorCSS := "" -}}
{{- if eq $env "open-source" -}}
  {{- $colorCSS = resources.Get "css/colors-opensource.css" -}}
{{- else if eq $env "nvidia" -}}
  {{- $colorCSS = resources.Get "css/colors-nvidia.css" -}}
{{- else if eq $env "enterprise" -}}
  {{- $colorCSS = resources.Get "css/colors-enterprise.css" -}}
{{- end -}}

{{/* Fallback to default colors if environment-specific not found */}}
{{- if not $colorCSS -}}
  {{- $colorCSS = resources.Get "css/colors.css" -}}
  {{- if eq $env "development" -}}
    {{- warnf "Environment CSS: No specific colors found for '%s', using default colors" $env -}}
  {{- end -}}
{{- end -}}

{{- if $colorCSS -}}
  {{- $cssResources = $cssResources | append $colorCSS -}}
{{- end -}}

{{/* Add page enhancement styles */}}
{{- $enhancementCSS := resources.Get "css/page-enhancements.css" -}}
{{- if $enhancementCSS -}}
  {{- $cssResources = $cssResources | append $enhancementCSS -}}
{{- else -}}
  {{- warnf "Enhancement CSS: page-enhancements.css not found" -}}
{{- end -}}

{{/* Add component styles */}}
{{- $debugCSS := resources.Get "css/components/debug.css" -}}
{{- if $debugCSS -}}
  {{- $cssResources = $cssResources | append $debugCSS -}}
{{- else -}}
  {{- warnf "Component CSS: debug.css not found" -}}
{{- end -}}

{{/* Add notice component styles */}}
{{- $noticeCSS := resources.Get "css/components/notice.css" -}}
{{- if $noticeCSS -}}
  {{- $cssResources = $cssResources | append $noticeCSS -}}
{{- else -}}
  {{- warnf "Component CSS: notice.css not found" -}}
{{- end -}}

{{/* Add article header component styles */}}
{{- $articleHeaderCSS := resources.Get "css/components/article-header.css" -}}
{{- if $articleHeaderCSS -}}
  {{- $cssResources = $cssResources | append $articleHeaderCSS -}}
{{- else -}}
  {{- warnf "Component CSS: article-header.css not found" -}}
{{- end -}}

{{/* Add breadcrumbs component styles */}}
{{- $breadcrumbsCSS := resources.Get "css/components/breadcrumbs.css" -}}
{{- if $breadcrumbsCSS -}}
  {{- $cssResources = $cssResources | append $breadcrumbsCSS -}}
{{- else -}}
  {{- warnf "Component CSS: breadcrumbs.css not found" -}}
{{- end -}}

{{/* Metadata styles are now included in article-header.css */}}

{{/* Advanced CSS bundling with environment-specific optimization */}}
{{- if $cssResources -}}
  {{- $bundleName := printf "css/bundle-%s.css" hugo.Environment -}}
  {{- $cssBundle := $cssResources | resources.Concat $bundleName -}}
  
  {{- if hugo.IsProduction -}}
    {{/* Production: Full optimization pipeline */}}
    {{- $cssOptimized := $cssBundle | minify | fingerprint "sha512" -}}
    <link rel="stylesheet" href="{{ $cssOptimized.RelPermalink }}" integrity="{{ $cssOptimized.Data.Integrity }}" crossorigin="anonymous">
    {{- if eq hugo.Environment "development" -}}
      {{/* Development mode with production flag - add source map reference */}}
      <!-- CSS Source: {{ $cssBundle.RelPermalink }} -->
    {{- end -}}
  {{- else -}}
    {{/* Development: Fast rebuilds with debugging info */}}
    <link rel="stylesheet" href="{{ $cssBundle.RelPermalink }}">
    {{- if site.Params.debug -}}
      <!-- CSS Debug: Bundle contains {{ len $cssResources }} files for {{ hugo.Environment }} environment -->
    {{- end -}}
  {{- end -}}
  
  {{/* Environment-specific CSS custom properties for JavaScript integration */}}
  <style>
    :root {
      --hugo-environment: "{{ hugo.Environment }}";
      --hugo-build: "{{ cond hugo.IsProduction "production" "development" }}";
      --theme-version: "{{ site.Params.version.major | default 0 }}.{{ site.Params.version.minor | default 0 }}.{{ site.Params.version.patch | default 0 }}";
    }
  </style>
{{- else -}}
  {{- errorf "CSS: No CSS resources found to bundle for environment '%s'" hugo.Environment -}}
{{- end -}}