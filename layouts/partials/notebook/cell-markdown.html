{{/*
  Notebook Markdown Cell Partial
  Renders a markdown cell with proper structure and metadata
  
  Context: dict with "cell" (cell data) and "index" (cell index)
  Usage: {{ partial "notebook/cell-markdown.html" (dict "cell" $cell "index" $index) }}
*/}}

{{ $cell := .cell }}
{{ $index := .index }}
{{ $cellId := printf "cell-markdown-%d" $index }}

<section class="collapse notebook-cell notebook-cell--markdown" 
         id="{{ $cellId }}"
         data-cell-type="markdown" 
         data-cell-index="{{ $index }}"
         data-collapse-state="expanded"
         data-component-state="ready"
         style="--cell-index: {{ $index }}">
  
  <div class="collapse__header notebook-cell__header" 
       onclick="toggleCollapse('{{ $cellId }}')"
       role="button"
       tabindex="0"
       aria-expanded="true"
       aria-controls="{{ $cellId }}-body"
       onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCollapse('{{ $cellId }}');}">
    
    <div class="collapse__icon-wrapper">
      <svg class="collapse__icon" 
           xmlns="http://www.w3.org/2000/svg" 
           fill="none" 
           viewBox="0 0 24 24" 
           stroke-width="2.5" 
           stroke="currentColor"
           aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    </div>
    
    <div class="collapse__content-wrapper">
      <div class="notebook-cell__type">
        <span class="notebook-cell__number">{{ add $index 1 }}</span>
        <span class="notebook-cell__type-icon" aria-hidden="true">
          <svg viewBox="0 0 16 16" fill="currentColor">
            <path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7.5L5.5 8.92 3.5 11H2l2.5-3.5L2 4h1.5l2 2.08L7.5 4H9l-2.5 3.5L9 11zm5 0h-1.5V6.25L11.25 8 10 6.25V11H8.5V4H10l1.25 1.75L12.5 4H14v7z"/>
          </svg>
        </span>
        <h3 class="notebook-cell__type-text">Markdown Cell</h3>
      </div>
    </div>
  </div>
  
  <div class="collapse__body" 
       id="{{ $cellId }}-body"
       role="region"
       aria-labelledby="{{ $cellId }}-header">
    <div class="collapse__body-content">
      {{/*
        Process markdown cell source
        Concatenate source lines and render as markdown
      */}}
      {{ $source := "" }}
      {{ range $cell.source }}
        {{ $source = printf "%s%s" $source . }}
      {{ end }}
      
      <div class="notebook-cell__markdown-content">
        {{ $source | markdownify }}
      </div>
    </div>
  </div>
</section>