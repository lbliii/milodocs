{{- $components := .components -}}
{{- $page := .page -}}

<section class="openapi-components" 
         id="components"
         data-component="openapi-components"
         data-has-schemas="{{ if $components.Schemas }}true{{ else }}false{{ end }}"
         data-has-responses="{{ if $components.Responses }}true{{ else }}false{{ end }}"
         data-has-parameters="{{ if $components.Parameters }}true{{ else }}false{{ end }}"
         data-has-examples="{{ if $components.Examples }}true{{ else }}false{{ end }}"
         data-has-headers="{{ if $components.Headers }}true{{ else }}false{{ end }}"
         data-has-links="{{ if $components.Links }}true{{ else }}false{{ end }}"
         data-has-callbacks="{{ if $components.Callbacks }}true{{ else }}false{{ end }}"
         data-schema-count="{{ if $components.Schemas }}{{ len $components.Schemas }}{{ else }}0{{ end }}"
         data-response-count="{{ if $components.Responses }}{{ len $components.Responses }}{{ else }}0{{ end }}"
         data-parameter-count="{{ if $components.Parameters }}{{ len $components.Parameters }}{{ else }}0{{ end }}">
  
  <!-- Schemas -->
  {{ partial "openapi/components/schemas.html" (dict "schemas" $components.Schemas "spec" $.spec "page" $page) }}
  
  <!-- Security Schemes -->
  {{ partial "openapi/components/security-schemes.html" (dict "securitySchemes" $components.SecuritySchemes "spec" $.spec "page" $page) }}
  
  <!-- Response Objects -->
  {{ partial "openapi/components/responses.html" (dict "responses" $components.Responses "spec" $.spec "page" $page) }}
  
  <!-- Parameters -->
  {{ partial "openapi/components/parameters.html" (dict "parameters" $components.Parameters "spec" $.spec "page" $page) }}

</section>

<!-- Initialize component collapse manually since it might not be inside .openapi-spec -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const componentHeaders = document.querySelectorAll('.openapi-components .collapse__header:not([data-openapi-collapse])');
  componentHeaders.forEach(header => {
    header.addEventListener('click', function(e) {
      e.preventDefault();
      const target = header.getAttribute('data-target');
      const targetElement = document.getElementById(target);
      const isExpanded = header.getAttribute('aria-expanded') === 'true';
      
      header.setAttribute('aria-expanded', !isExpanded);
      
      if (targetElement) {
        if (isExpanded) {
          targetElement.classList.remove('expanded');
        } else {
          targetElement.classList.add('expanded');
        }
      }
      
      console.log('Schema collapse:', { target, isExpanded: !isExpanded });
    });
  });
  
  console.log(`Initialized ${componentHeaders.length} component collapse headers`);
});
</script>