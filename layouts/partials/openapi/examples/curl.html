{{- $method := .method -}}
{{- $path := .path -}}
{{- $operation := .operation -}}
{{- $spec := .spec -}}

{{- /* Build the base URL from servers */ -}}
{{- $baseUrl := "https://api.example.com" -}}
{{- if $spec.Servers -}}
  {{- $baseUrl = (index $spec.Servers 0).URL -}}
{{- end -}}

{{- /* Start building the curl command */ -}}
curl -X {{ $method }} "{{ $baseUrl }}{{ $path }}"{{ if $operation.Parameters }}{{ range $param := $operation.Parameters }}{{ if eq $param.In "query" }}{{ if $param.Example }}{{ if eq $param.Name (index $operation.Parameters 0).Name }}?{{ else }}&{{ end }}{{ $param.Name }}={{ $param.Example }}{{ end }}{{ end }}{{ end }}{{ end }} \
{{- if $operation.Security }}
  -H "Authorization: Bearer YOUR_TOKEN" \{{ end }}
{{- if $operation.RequestBody }}
  -H "Content-Type: application/json" \
  -d '{
{{ range $mediaType, $content := $operation.RequestBody.Content }}{{ if eq $mediaType "application/json" }}{{ with $content.Example }}{{ . | jsonify (dict "indent" "    ") }}{{ else }}{{ with $content.Schema }}{{ if eq .Type "object" }}{{ partial "openapi/examples/json-example.html" . }}{{ end }}{{ end }}{{ end }}{{ end }}{{ end }}
  }'{{ else if or (eq $method "POST") (eq $method "PUT") (eq $method "PATCH") }}
  -H "Content-Type: application/json"{{ end }}