{{- $method := .method -}}
{{- $path := .path -}}
{{- $operation := .operation -}}
{{- $spec := .spec -}}

{{- /* Build the base URL from servers */ -}}
{{- $baseUrl := "https://api.example.com" -}}
{{- if $spec.servers -}}
  {{- $baseUrl = (index $spec.servers 0).url -}}
{{- end -}}

{{- /* Start building the curl command */ -}}
curl -X {{ $method }} "{{ $baseUrl }}{{ $path }}"{{ if $operation.parameters }}{{ range $param := $operation.parameters }}{{ if eq $param.in "query" }}{{ if $param.example }}{{ if eq $param.name (index $operation.parameters 0).name }}?{{ else }}&{{ end }}{{ $param.name }}={{ $param.example }}{{ end }}{{ end }}{{ end }}{{ end }} \
{{- if $operation.security }}
  -H "Authorization: Bearer YOUR_TOKEN" \{{ end }}
{{- if $operation.requestBody }}
  -H "Content-Type: application/json" \
  -d '{
{{ range $mediaType, $content := $operation.requestBody.content }}{{ if eq $mediaType "application/json" }}{{ with $content.example }}{{ . | jsonify (dict "indent" "    ") }}{{ else }}{{ with $content.schema }}{{ if eq .type "object" }}{{ partial "openapi/examples/json-example.html" . }}{{ end }}{{ end }}{{ end }}{{ end }}{{ end }}
  }'{{ else if or (eq $method "POST") (eq $method "PUT") (eq $method "PATCH") }}
  -H "Content-Type: application/json"{{ end }}