{{- $title := .Get "title" | default "Expand" -}}
{{- $description := .Get "description" -}}
{{- $variant := .Get "variant" | default "default" -}}
{{- $id := .Get "id" | default (printf "collapse-%s-%d" (md5 .Inner) (now.UnixNano)) -}}

{{- if ne hugo.Environment "pdf" -}}
<section class="collapse{{ if ne $variant "default" }} collapse--{{ $variant }}{{ end }}" id="{{ $id }}">
    <div class="collapse__header" 
         onclick="toggleCollapse('{{ $id }}')"
         role="button"
         tabindex="0"
         aria-expanded="false"
         aria-controls="{{ $id }}-body"
         onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCollapse('{{ $id }}');}">
        
        <div class="collapse__icon-wrapper">
            <svg class="collapse__icon" 
                 xmlns="http://www.w3.org/2000/svg" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke-width="2.5" 
                 stroke="currentColor"
                 aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
        </div>
        
        <div class="collapse__content-wrapper">
            {{- with $title -}}
            <h3 class="collapse__title">{{ . }}</h3>
            {{- end -}}
            {{- with $description -}}
            <p class="collapse__description">{{ . }}</p>
            {{- end -}}
        </div>
    </div>
    
    <div class="collapse__body" 
         id="{{ $id }}-body"
         role="region"
         aria-labelledby="{{ $id }}-header">
        <div class="collapse__body-content">
            {{ .Inner | markdownify }}
        </div>
    </div>
</section>

<script>
// Only define the function once
if (typeof window.toggleCollapse === 'undefined') {
    window.toggleCollapse = function(id) {
        const collapse = document.getElementById(id);
        if (!collapse) return;
        
        const header = collapse.querySelector('.collapse__header');
        const isExpanded = collapse.classList.contains('expanded');
        
        if (isExpanded) {
            collapse.classList.remove('expanded');
            header.setAttribute('aria-expanded', 'false');
        } else {
            collapse.classList.add('expanded');
            header.setAttribute('aria-expanded', 'true');
        }
    };
}
</script>

{{- else -}}
{{/* PDF fallback - just show content */}}
{{- with $title -}}
<h4>{{ . }}</h4>
{{- end -}}
{{ .Inner | markdownify }}
{{- end -}}
